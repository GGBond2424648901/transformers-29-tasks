# 路径说明文档

## 📁 项目结构

```
D:\transformers训练\transformers-main\
└── 实战训练\
    └── 情感分析\              ← 所有脚本必须在这里运行！
        ├── my_sentiment_model\    # 训练好的模型
        ├── logs\                  # 训练日志（自动生成）
        ├── Trainer_实战示例.py
        ├── 使用训练好的模型.py
        ├── 模型部署示例.py
        ├── 快速测试API.py
        ├── 测试API网页.html
        ├── 训练模型.bat           # 新增
        ├── 使用模型预测.bat       # 新增
        ├── 启动API服务.bat
        ├── 测试API.bat
        └── README.md
```

---

## ⚠️ 重要：路径问题

### 问题说明

所有 Python 脚本中使用的是**相对路径**：
- `./my_sentiment_model` - 在当前目录查找模型
- `./logs` - 在当前目录保存日志

这意味着：
- ✅ **正确**：在 `实战训练\情感分析\` 目录下运行脚本
- ❌ **错误**：在其他目录运行脚本（找不到模型）

---

## ✅ 正确的使用方法

### 方法 1: 双击批处理文件（推荐）

所有 `.bat` 文件都已配置自动切换到正确目录：

```batch
训练模型.bat          # 训练新模型
使用模型预测.bat      # 使用模型预测
启动API服务.bat       # 启动 API 服务
测试API.bat           # 测试 API
```

**原理**：批处理文件中包含 `cd /d "%~dp0"` 命令，会自动切换到脚本所在目录。

---

### 方法 2: 命令行运行

**步骤 1：进入项目目录**
```bash
cd D:\transformers训练\transformers-main\实战训练\情感分析
```

**步骤 2：运行脚本**
```bash
# 训练模型
D:\aaaalokda\envs\myenv\python.exe Trainer_实战示例.py

# 使用模型预测
D:\aaaalokda\envs\myenv\python.exe 使用训练好的模型.py

# 启动 API 服务
D:\aaaalokda\envs\myenv\python.exe 模型部署示例.py

# 测试 API
D:\aaaalokda\envs\myenv\python.exe 快速测试API.py
```

---

### 方法 3: Python 代码中使用

如果在其他 Python 脚本中使用模型，需要指定**完整路径**：

```python
from transformers import pipeline

# ❌ 错误：相对路径（只在项目目录下有效）
classifier = pipeline("text-classification", model="./my_sentiment_model")

# ✅ 正确：完整路径
model_path = r"D:\transformers训练\transformers-main\实战训练\情感分析\my_sentiment_model"
classifier = pipeline("text-classification", model=model_path)
```

---

## 🔍 路径验证

### 检查当前目录

**Windows CMD:**
```cmd
cd
```

**Windows PowerShell:**
```powershell
Get-Location
```

**Python:**
```python
import os
print(os.getcwd())
```

**期望输出：**
```
D:\transformers训练\transformers-main\实战训练\情感分析
```

---

### 检查模型是否存在

**Windows CMD:**
```cmd
dir my_sentiment_model
```

**Python:**
```python
import os
print(os.path.exists("./my_sentiment_model"))  # 应该输出 True
```

---

## 📝 文件中的路径配置

### Trainer_实战示例.py

```python
# 输出目录（相对路径）
output_dir="./my_sentiment_model"

# 日志目录（相对路径）
logging_dir='./logs'

# 保存模型（相对路径）
trainer.save_model("./my_sentiment_model")
```

### 使用训练好的模型.py

```python
# 加载模型（相对路径）
model_path = "./my_sentiment_model"
model = AutoModelForSequenceClassification.from_pretrained(model_path)
```

### 模型部署示例.py

```python
# 加载模型（相对路径）
model_path = "./my_sentiment_model"
classifier = pipeline("text-classification", model=model_path)
```

---

## 🛠️ 批处理文件的路径处理

所有 `.bat` 文件都包含以下代码：

```batch
@echo off
chcp 65001 >nul

REM 切换到脚本所在目录
cd /d "%~dp0"

echo 当前目录: %CD%
```

**说明：**
- `%~dp0` - 获取批处理文件所在的目录
- `cd /d` - 切换驱动器和目录
- `%CD%` - 显示当前目录

---

## ❓ 常见问题

### Q1: 运行脚本提示找不到模型？

**错误信息：**
```
FileNotFoundError: [Errno 2] No such file or directory: './my_sentiment_model/config.json'
```

**解决方案：**
1. 检查当前目录是否正确
2. 确保在 `实战训练\情感分析\` 目录下运行
3. 使用批处理文件运行（自动切换目录）

---

### Q2: 如何在其他地方使用模型？

**方案 A：使用完整路径**
```python
model_path = r"D:\transformers训练\transformers-main\实战训练\情感分析\my_sentiment_model"
classifier = pipeline("text-classification", model=model_path)
```

**方案 B：复制模型到新位置**
```bash
# 复制整个模型文件夹
xcopy /E /I "D:\transformers训练\transformers-main\实战训练\情感分析\my_sentiment_model" "C:\my_models\sentiment"
```

**方案 C：上传到 Hugging Face Hub**
```python
from huggingface_hub import HfApi

api = HfApi()
api.upload_folder(
    folder_path="./my_sentiment_model",
    repo_id="your-username/sentiment-model"
)

# 然后从任何地方使用
classifier = pipeline("text-classification", model="your-username/sentiment-model")
```

---

### Q3: 批处理文件无法运行？

**可能原因：**
1. Python 路径不正确
2. 环境变量未设置

**解决方案：**
检查 Python 路径是否正确：
```batch
D:\aaaalokda\envs\myenv\python.exe --version
```

如果路径不对，修改批处理文件中的 Python 路径。

---

## 📋 总结

### ✅ 推荐做法

1. **使用批处理文件** - 自动处理路径问题
2. **在项目目录运行** - 确保相对路径正确
3. **使用完整路径** - 在其他地方使用模型时

### ❌ 避免的做法

1. 在其他目录运行脚本
2. 手动修改代码中的路径
3. 移动模型文件而不更新路径

---

## 🎯 快速检查清单

运行脚本前，确认：

- [ ] 当前目录是 `实战训练\情感分析\`
- [ ] `my_sentiment_model` 文件夹存在
- [ ] Python 环境正确（`D:\aaaalokda\envs\myenv\python.exe`）
- [ ] 使用批处理文件或已切换到正确目录

---

**如有问题，请查看 README.md 或 快速开始.txt**

# 表格问答使用技巧

## ⚠️ 重要提示：必须使用英文表格！

**TAPAS模型对中文支持非常有限！** 强烈建议使用英文列名的表格。

### 为什么中文表格效果差？

TAPAS模型在英文Wikipedia表格上训练，它：
- ❌ 不理解中文列名（"工资"、"年龄"等）
- ❌ 无法正确匹配中文问题和列
- ❌ 经常返回错误的列数据

**示例问题：**
- 问"What is the average salary?"，中文表格可能返回年龄而不是工资
- 问"What is the total salary?"，可能返回姓名列表而不是工资总和

### ✅ 解决方案：使用英文表格

**推荐的表格格式：**
```csv
Name,Age,Department,Salary
Zhang San,25,Tech,8000
Li Si,30,Sales,9000
Wang Wu,28,Tech,8500
Zhao Liu,35,Sales,9500
Sun Qi,27,Tech,7800
```

**关键点：**
- ✅ 列名必须是英文（Name, Age, Salary等）
- ✅ 数据可以是中文（张三、李四等）
- ✅ 问题必须用英文，并明确提到列名

## ✅ 服务已正常运行

降级pandas后，表格问答服务已经可以正常工作了！

## 💡 如何提出好问题

### 问题要具体明确

❌ **不好的问题：**
- "How many people?" - 太模糊，不知道统计什么
- "What is the average?" - 不知道要平均哪一列
- "What is the total?" - 不知道要总和哪一列

✅ **好的问题：**
- "How many employees are there?" - 明确要统计员工人数
- "What is the average salary?" - 明确要计算工资平均值
- "What is the total salary?" - 明确要计算工资总和
- "Who has the highest salary?" - 明确要找工资最高的人

### 使用英文提问

TAPAS模型是在英文数据上训练的，英文问题效果最好：

✅ **推荐：**
```
How many employees are there?
What is the average salary?
Who has the highest salary?
What is the total revenue?
```

❌ **不推荐（中文）：**
```
有多少员工？
平均工资是多少？
```

### 表格数据必须使用英文列名

虽然TAPAS可以处理中文表格，但英文列名效果更好：

✅ **推荐的表格格式：**
```csv
Name,Age,Department,Salary,Year
Zhang San,25,Tech,8000,2020
Li Si,30,Sales,9000,2018
Wang Wu,28,Tech,8500,2019
```

❌ **不推荐（中文列名）：**
```csv
姓名,年龄,部门,工资,年份
张三,25,技术部,8000,2020
```

## 📊 示例问题

### 针对员工信息表格

**表格列：** Name, Age, Department, Salary, Year

**好的问题示例：**

1. **统计人数：**
   - "How many employees are there?" - 总人数
   - "How many people work in Tech?" - 技术部人数
   - "How many employees joined in 2020?" - 2020年入职人数

2. **计算平均值：**
   - "What is the average salary?" - 平均工资
   - "What is the average age?" - 平均年龄
   - "What is the average salary in Tech?" - 技术部平均工资

3. **查找最大/最小值：**
   - "Who has the highest salary?" - 工资最高的人
   - "Who is the youngest?" - 最年轻的人
   - "Who joined first?" - 最早入职的人

4. **求和：**
   - "What is the total salary?" - 工资总和
   - "What is the total salary in Sales?" - 销售部工资总和

### 针对销售数据表格

**表格列：** Product, Price, Quantity, Revenue, Month

**好的问题示例：**

1. "How many products are there?"
2. "What is the total revenue?"
3. "Which product has the highest price?"
4. "What is the average quantity?"
5. "What is the total revenue in January?"

## ⚠️ 注意事项

### TAPAS模型的限制

1. **不是通用AI** - TAPAS是专门的表格问答模型，只能回答表格相关的问题
2. **需要明确的列名** - 问题中要提到表格中存在的列名
3. **简单查询** - 复杂的多步骤查询可能不准确
4. **英文优先** - 在英文列名和英文问题上表现最好

### 常见问题

**Q: 为什么回答不准确？**
A: 可能是问题太模糊，或者列名是中文的。尝试：
- 使用更具体的英文问题
- 将表格列名改成英文
- 明确指定要查询的列名

**Q: 可以问复杂的问题吗？**
A: TAPAS适合简单的查询，如统计、求和、平均值、最大最小值。复杂的多表关联或多步骤推理可能不准确。

**Q: 支持中文吗？**
A: 技术上支持，但效果很差。强烈建议使用英文列名和英文问题。

## 🎯 最佳实践

1. **表格列名用英文** - 列名必须用英文（Name, Age, Salary等）
2. **数据可以是中文** - 数据内容可以是中文（张三、李四等）
3. **问题要具体** - 明确指定要查询的列和条件
4. **一次问一个问题** - 不要在一个问题中包含多个查询
5. **使用简单的英文** - 避免复杂的句式
6. **测试和调整** - 如果回答不对，尝试换个问法

## 📝 问题模板

### 统计数量
```
How many [items] are there?
How many [items] are in [category]?
```

### 计算平均值
```
What is the average [column]?
What is the average [column] in [category]?
```

### 查找最值
```
Who/What has the highest [column]?
Who/What has the lowest [column]?
Which [item] has the most [column]?
```

### 求和
```
What is the total [column]?
What is the sum of [column] in [category]?
```

## 🔧 故障排除

如果遇到问题：

1. **检查pandas版本** - 确保是1.5.x，不是2.x或3.x
   ```bash
   python -c "import pandas; print(pandas.__version__)"
   ```

2. **检查列名** - 确保列名是英文
   ```csv
   Name,Age,Salary  ✅
   姓名,年龄,工资  ❌
   ```

3. **检查问题** - 确保问题中明确提到列名
   ```
   What is the average salary?  ✅
   What is the average?  ❌
   ```

4. **重启服务** - 降级pandas后需要重启服务

5. **查看控制台日志** - 服务器会打印详细的调试信息

6. **使用测试文件** - 使用提供的`员工信息测试_英文版.csv`或`销售数据测试.csv`测试

## 📁 测试文件

我们提供了三个测试CSV文件：

1. **员工信息测试.csv** - 中文列名（效果差）❌
2. **员工信息测试_英文版.csv** - 英文列名（效果好）✅
3. **销售数据测试.csv** - 英文销售数据（效果好）✅

**建议：** 先用英文版测试，熟悉后再处理自己的数据。

---

**提示：** 表格问答是一个专门的AI任务，需要一些练习才能掌握如何提出好问题。多尝试不同的问法，找到最适合你数据的提问方式！

**重要：** 如果你的数据列名是中文的，请先转换成英文再使用！详见《已知问题说明.md》。
